$def with(plugin_options, events)

$var title: $_('CHMI meteoradar')
$var page: plugins
<script>
    function checkIP(){
        let IPAddress = jQuery(".IPnumbersOnly").val();
        let IPRegex=new RegExp("^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)");
        let test = IPRegex.test(IPAddress);
        if(test){
            return 0;
        }
        else{    
            alert($:{json.dumps(_('IP map address is not valid!'), ensure_ascii=False).encode('utf8').decode('utf-8')});
            return 1;
        }
    }

    // Initialize behaviors
    jQuery(document).ready(function(){
        jQuery("#cRefresh").click(function() {
            window.location="/plugins/chmi/settings";
        });
        jQuery("#cSubmit").click(function() {
            if(checkIP()){
                return;
            }
            jQuery("#pluginForm").submit();
        });
        jQuery("button#cCancel").click(function(){
            window.location="/";
        });

        jQuery(".IPnumbersOnly").keyup(function () {
            let newValue = this.value.replace(/[^0-9\.]/g, '');
            this.value = newValue;
        });

    });
</script>

<div id="plugin">
    <div class="title">$_('CHMI meteoradar')</div>
    <p>$_('The measurement time is primarily given in UTC world time (UTC=UT=GMT=SELC-2h = CET-1h).')</p>
    <a href=$plugins.plugin_url('chmi.help_page') class="button upload">$_('Help')</a><br/>
    <form id="pluginForm" action="$plugins.plugin_url('chmi.settings_page')" method="post">
        <table class="optionList">
            <tr>
                <td style='text-transform: none;'>$_('Use CHMI'):</td>
                <td title=$:{json.dumps(_(u'When the box is checked, the extension will be active.'), ensure_ascii=False)}>
                    <input name='enabled' type='checkbox'${" checked" if plugin_options['enabled'] else ""}>
                </td>
            </tr>
            <tr>
                <td style='text-transform: none;'>$_('Map IP address'):</td>
                <td title=$:{json.dumps(_(u'IP address for map.'), ensure_ascii=False)}><input name='IP_ADDR' class="Input IPnumbersOnly" type='text' size='15' maxlength='15' id='IPnumbersOnly' value='$plugin_options["IP_ADDR"]'>
                </td>
            </tr>
            <tr>
                <td style='text-transform: none;'>$_('Map board type'):</td>
                <td>
                    <select name='HW_BOARD' title=$:{json.dumps(_(u'Mark used your board hardware.'), ensure_ascii=False).encode('utf8').decode('utf-8')}>
                    <option value="0" ${" selected" if plugin_options['HW_BOARD']=="0" else ""}>$_('Laskakit')</option>
                    <option value="1" ${" selected" if plugin_options['HW_BOARD']=="1" else ""}>$_('TMEP')</option>
                    <option value="2" ${" selected" if plugin_options['HW_BOARD']=="2" else ""}>$_('Pihrt')</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td style='text-transform: none;'>$_('Meteo map'):</td>
                <td title=$:{json.dumps(_(u'A downloaded map from the Meteo Institute is displayed here.'), ensure_ascii=False)}>
                    <a href="$plugins.plugin_url('chmi.download_page')"><img src="$plugins.plugin_url('chmi.download_page')" width="640"></a>
                </td>
            </tr>
            <tr>
                <td style='text-transform: none;'><small>$_('My location lat/lon') ${options.weather_lat}/${options.weather_lon}</small></td>
                <td>
                    $ patch = 'https://www.openstreetmap.org/#map=15/' + options.weather_lat + '/' + options.weather_lon
                    <a href="${patch}" class="button upload" target="_blank" title=$:{json.dumps(_(u'Displaying the found area on the map'), ensure_ascii=False).encode('utf8').decode('utf-8')}>$_('Map')</a>
                </td>
            </tr>
            <tr>
               <th colspan="2">
                 <hr>
               </th>
            </tr>            
            <tr>
                <td style='text-transform: none;'>$_('Use a rain delay'):</td>
                <td title=$:{json.dumps(_(u'If the box is checked, a rain delay will be set if rain is detected. The location coordinates are obtained from the OSPy settings from the weather/location menu. For proper function, you need to enter your location in the settings (for example, Prague).'), ensure_ascii=False)}>
                    <input name='USE_RAIN_DELAY' type='checkbox'${" checked" if plugin_options['USE_RAIN_DELAY'] else ""}>
                </td>
            </tr>
            <tr>
                <td style='text-transform: none;'>$_('Delay time'):</td>
                <td title=$:{json.dumps(_(u'Delay time in hours.'), ensure_ascii=False)}>
                    <input name='RAIN_DELAY' type='number' min='1' value='$plugin_options["RAIN_DELAY"]'> $_('(in hours)')
                    <a href="?del_rain"  class="button cancel danger">$_('Removing Rain Delay')</a>
                </td>
            </tr>
            <tr>
                <td style='text-transform: none;'>$_('Intensity threshold'):</td>
                <td title=$:{json.dumps(_(u'Intensity threshold for activate rain delay in my location.'), ensure_ascii=False)}>
                    <input name='RGB_INTENS' type='number' min='0' max='765' value='$plugin_options["RGB_INTENS"]'> $_('R+G+B (max is 255+255+255)')
                </td>
            </tr>
            <tr>
               <th colspan="2">
                 <hr>
               </th>
            </tr>            
            <tr>
                <td style='text-transform: none;'>$_('Show in footer'):</td>
                <td title=$:{json.dumps(_(u'Show data from plugin in footer on home page'), ensure_ascii=False).encode('utf-8').decode('utf-8')}>
                    <input name='use_footer' type='checkbox'${" checked" if plugin_options['use_footer'] else ""}>
                </td>
            </tr>                        
            <tr>
                <td style='text-transform: none;'>$_('Status'):</td>
                <td>
                    <textarea style="font-family: monospace;" rows="18" cols="95" readonly>$'\n'.join(events)</textarea>
                </td>
            </tr>
        </table>
    </form>
</div>
<div id="controls">
    <button id="cRefresh" class="submit"><b>$_('Refresh')</b></button>
    <button id="cSubmit" class="submit"><b>$_('Submit')</b></button>
    <button id="cCancel" class="cancel danger">$_('Cancel')</button>
</div>