$def with(plugin_options, events)

$var title: $_('Current Loop Tanks - Setup')
$var page: plugins

<style>
.switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.switch input {
    display: none;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ff4d4d; /* Default red for 'off' */
    transition: 0.4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    border-radius: 50%;
    left: 4px;
    bottom: 3px;
    background-color: white;
    transition: 0.4s;
}

/* Green color when switch is 'on' */
input:checked + .slider {
    background-color: #4caf50;
}

input:checked + .slider:before {
    transform: translateX(26px);
}

th {
    text-align: left;
    padding-left: 10px;
}

table.optionList {
    table-layout: fixed;
    width: 100%;
}

table.optionList td, table.optionList th {
    word-wrap: break-word;
    overflow: hidden;
}


td[colspan="2"] input {
    width: 80%;
}

td[colspan="5"] input {
    width: 80%;
}

textarea {
    width: 95%;
}
</style>

<script>
jQuery(document).ready(function(){
    jQuery("#cSubmit").click(function() {
        jQuery("#pluginForm").submit();
    });
    jQuery("#cSubmit2").click(function() {
        jQuery("#pluginForm").submit();
    });    
});
</script>

<div id="plugin">
    <div class="title">$_('Current Loop Tanks - Setup')</div>
        <div id="controls">
            <button id="cSubmit" class="submit"><b>$_('Submit')</b></button>
            <a href="/plugins/current_loop_tanks_monitor/settings" class="button danger">$_('Cancel')</a>
        </div>
        <form id="pluginForm" action="$plugins.plugin_url('current_loop_tanks_monitor.setup_page')" method="post">
            <table class="optionList">
                <tr>
                    <td colspan="6"></td>
                    <td><b><small>$_('Tanks')</small></b></td>
                </tr>

                <tr>
                    <th>$_('Tank Name')</th>
                    <th>$_('Enabled')</th>
                    <th>$_('Max Height (cm)')</th>
                    <th>$_('Max Volume (l)')</th>
                    <th>$_('Min Voltage (V)')</th>
                    <th>$_('Max Voltage (V)')</th>
                </tr>
                
                <!-- Tank 1 -->
                <tr>
                    <td><input name="label1" type="text" value="$plugin_options['label1']"></td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" name="en_tank1" ${'checked' if plugin_options['en_tank1'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('Here, enter the distance from the sensor to the maximum level in centimeters.'), ensure_ascii=False)}><input name="maxHeightCm1" type="number" value="$plugin_options['maxHeightCm1']"></td>
                    <td title=$:{json.dumps(_('Here, enter the volume of the tank at 100% volume (regardless of the shape of the tank).'), ensure_ascii=False)}><input name="maxVolume1" type="number" value="$plugin_options['maxVolume1']"></td>
                    <td title=$:{json.dumps(_('Minimum voltage from the probe on the AD converter (for 4mA ie empty tank).'), ensure_ascii=False)}><input name="minVolt1" type="number" step="0.001" min="0" value="$plugin_options['minVolt1']"></td>
                    <td title=$:{json.dumps(_('Maximum voltage from the probe on the AD converter (for 20mA ie full tank). 4.096V is max range for 16bit convert.'), ensure_ascii=False)}><input name="maxVolt1" type="number" step="0.001" min="0" max="4.096" value="$plugin_options['maxVolt1']"></td>
                </tr>

                <!-- Tank 2 -->
                <tr>
                    <td><input name="label2" type="text" value="$plugin_options['label2']"></td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" name="en_tank2" ${'checked' if plugin_options['en_tank2'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('Here, enter the distance from the sensor to the maximum level in centimeters.'), ensure_ascii=False)}><input name="maxHeightCm2" type="number" value="$plugin_options['maxHeightCm2']"></td>
                    <td title=$:{json.dumps(_('Here, enter the volume of the tank at 100% volume (regardless of the shape of the tank).'), ensure_ascii=False)}><input name="maxVolume2" type="number" value="$plugin_options['maxVolume2']"></td>
                    <td title=$:{json.dumps(_('Minimum voltage from the probe on the AD converter (for 4mA ie empty tank).'), ensure_ascii=False)}><input name="minVolt2" type="number" step="0.001" min="0" value="$plugin_options['minVolt2']"></td>
                    <td title=$:{json.dumps(_('Maximum voltage from the probe on the AD converter (for 20mA ie full tank). 4.096V is max range for 16bit convert.'), ensure_ascii=False)}><input name="maxVolt2" type="number" step="0.001" min="0" max="4.096" value="$plugin_options['maxVolt2']"></td>
                </tr>

                <!-- Tank 3 -->
                <tr>
                    <td><input name="label3" type="text" value="$plugin_options['label3']"></td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" name="en_tank3" ${'checked' if plugin_options['en_tank3'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('Here, enter the distance from the sensor to the maximum level in centimeters.'), ensure_ascii=False)}><input name="maxHeightCm3" type="number" value="$plugin_options['maxHeightCm3']"></td>
                    <td title=$:{json.dumps(_('Here, enter the volume of the tank at 100% volume (regardless of the shape of the tank).'), ensure_ascii=False)}><input name="maxVolume3" type="number" value="$plugin_options['maxVolume3']"></td>
                    <td title=$:{json.dumps(_('Minimum voltage from the probe on the AD converter (for 4mA ie empty tank).'), ensure_ascii=False)}><input name="minVolt3" type="number" step="0.001" min="0" value="$plugin_options['minVolt3']"></td>
                    <td title=$:{json.dumps(_('Maximum voltage from the probe on the AD converter (for 20mA ie full tank). 4.096V is max range for 16bit convert.'), ensure_ascii=False)}><input name="maxVolt3" type="number" step="0.001" min="0" max="4.096" value="$plugin_options['maxVolt3']"></td>
                </tr>

                <!-- Tank 4 -->
                <tr>
                    <td><input name="label4" type="text" value="$plugin_options['label4']"></td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" name="en_tank4" ${'checked' if plugin_options['en_tank4'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('Here, enter the distance from the sensor to the maximum level in centimeters.'), ensure_ascii=False)}><input name="maxHeightCm4" type="number" value="$plugin_options['maxHeightCm4']"></td>
                    <td title=$:{json.dumps(_('Here, enter the volume of the tank at 100% volume (regardless of the shape of the tank).'), ensure_ascii=False)}><input name="maxVolume4" type="number" value="$plugin_options['maxVolume4']"></td>
                    <td title=$:{json.dumps(_('Minimum voltage from the probe on the AD converter (for 4mA ie empty tank).'), ensure_ascii=False)}><input name="minVolt4" type="number" step="0.001" min="0" value="$plugin_options['minVolt4']"></td>
                    <td title=$:{json.dumps(_('Maximum voltage from the probe on the AD converter (for 20mA ie full tank). 4.096V is max range for 16bit convert.'), ensure_ascii=False)}><input name="maxVolt4" type="number" step="0.001" min="0" max="4.096" value="$plugin_options['maxVolt4']"></td>
                </tr>

                <!-- logging and graphing -->
                <tr>
                    <td colspan="6"><hr></td>
                    <td><b><small>$_('Logs and graphs')</small></b></td>
                </tr>

                <tr>
                    <td>$_('Show data in graph and log from')</td>
                    <td title=$:{json.dumps(_('Choose from where the displayed data in the log and graph will be loaded.'), ensure_ascii=False)}>
                        <select name="type_log">
                            <option value="0" ${'selected' if plugin_options['type_log'] == 0 else ''}>$_('Local File')</option>
                            <option value="1" ${'selected' if plugin_options['type_log'] == 1 else ''}>$_('Database File')</option>
                        </select>
                    </td>
                </tr>

                <tr>
                    <td>$_('Enable SQL Logging')</td>
                    <td title=$:{json.dumps(_('The measured data will be stored in the database. This option requires the database connector extension to be installed and configured.'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="en_sql_log" ${'checked' if plugin_options['en_sql_log'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td colspan="2" title=$:{json.dumps(_('The button will delete the currentmonitor table from the database, thus deleting all saved data from this extension! This promotion is non-refundable!'), ensure_ascii=False)}>
                        <a href="?delSQL" class="button cancel danger">$_('Delete SQL table')</a>
                    </td>
                </tr>

                <tr>
                    <td>$_('Enable local logging')</td>
                    <td title=$:{json.dumps(_('The measured data will be saved locally in a json file. This option rapidly reduces the lifespan of the SD/USB card of the Raspberry Pi system!'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="en_log" ${'checked' if plugin_options['en_log'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                </tr>

                <tr>
                    <td>$_('Maximum number of log records'):</td>
                    <td title=$:{json.dumps(_('0 = unlimited. The maximum number of records sets the number of saved records, i.e. after exceeding the set limit, older data is overwritten.'), ensure_ascii=False)}>
                        <input name='log_records' type='number' min='0' value='$plugin_options["log_records"]'>
                    </td>
                </tr>

                <tr>
                    <td>$_('Interval for logging'):</td>
                    <td title=$:{json.dumps(_('In minutes (Minimum is 1). The logging interval is common for both local storage and sql storage of measured data.'), ensure_ascii=False)}>
                        <input name='log_interval' type='number' min='1' step="1" value='$plugin_options["log_interval"]'> 
                    </td>
                </tr>

                <tr>
                    <td>$_('Show data in graph from')</td>
                    <td title=$:{json.dumps(_('Datetime FROM for Filtering.'), ensure_ascii=False)}><input name="dt_from" type="datetime-local" value="$plugin_options['dt_from']"></td>
                </tr>

                <tr>
                    <td>$_('Show data in graph to')</td>
                    <td title=$:{json.dumps(_('Datetime TO for Filtering.'), ensure_ascii=False)}><input name="dt_to" type="datetime-local" value="$plugin_options['dt_to']"></td>
                </tr>

                <!-- Communications -->
                <tr>
                    <td colspan="6"><hr></td>
                    <td><b><small>$_('Communications')</small></b></td>
                </tr>

                <tr>
                    <td>$_('I2C Address')</td>
                    <td title=$:{json.dumps(_('Default address is 0x48.'), ensure_ascii=False)}>
                        <select name="i2c">
                            <option value="0" ${'selected' if plugin_options['i2c'] == 0 else ''}>0x48</option>
                            <option value="1" ${'selected' if plugin_options['i2c'] == 1 else ''}>0x49</option>
                            <option value="2" ${'selected' if plugin_options['i2c'] == 2 else ''}>0x4A</option>
                            <option value="3" ${'selected' if plugin_options['i2c'] == 3 else ''}>0x4B</option>
                        </select>
                    </td>
                </tr>

                <!-- display and graphics -->
                <tr>
                    <td colspan="6"><hr></td>
                    <td><b><small>$_('Display and graphics')</small></b></td>
                </tr>

                <tr>
                    <td>$_('Use Footer')</td>
                    <td title=$:{json.dumps(_('Show data from plugin in footer on home page.'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="use_footer" ${'checked' if plugin_options['use_footer'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                </tr>
                <tr>
                    <td>$_('Use Injection Script')</td>
                    <td title=$:{json.dumps(_('Create tanks charts from a plugin on the home page. You always need to restart OSPy afterwards for this option.'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="use_script" ${'checked' if plugin_options['use_script'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                </tr>

                <!-- Notifications -->
                <tr>
                    <td colspan="6"><hr></td>
                    <td><b><small>$_('Notifications')</small></b></td>
                </tr>

                <tr>
                    <th>$_('Tank')</th>
                    <th>$_('Send E-mail')</th>
                    <th>$_('Level activation (%)')</th>
                    <th>$_('Level release (%)')</th>
                    <th>$_('Subject')</th>
                </tr>

                <!-- Tank 1 -->
                <tr>
                    <td>$plugin_options['label1']</td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" name="en_eml_tank1_low" ${'checked' if plugin_options['en_eml_tank1_low'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If the level drops below this value, sending an email is activated.'), ensure_ascii=False)}><input name="eml_tank1_low_lvl" type="number" min="0" max="100" step="1" value="$plugin_options['eml_tank1_low_lvl']"></td>
                    <td title=$:{json.dumps(_('As long as the level does not rise above this level, it will not allow sending an email when the level drops to the minimum. This is used to block the constant sending of emails when the level is at a minimum.'), ensure_ascii=False)}><input name="eml_tank1_high_lvl" type="number" min="0" max="100" step="1" value="$plugin_options['eml_tank1_high_lvl']"></td>
                    <td colspan="2"><input name="eml_subject_1" type="text" value="$plugin_options['eml_subject_1']"></td>
                </tr>

                <!-- Tank 2 -->
                <tr>
                    <td>$plugin_options['label2']</td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" name="en_eml_tank2_low" ${'checked' if plugin_options['en_eml_tank2_low'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If the level drops below this value, sending an email is activated.'), ensure_ascii=False)}><input name="eml_tank2_low_lvl" type="number" min="0" max="100" step="1" value="$plugin_options['eml_tank2_low_lvl']"></td>
                    <td title=$:{json.dumps(_('As long as the level does not rise above this level, it will not allow sending an email when the level drops to the minimum. This is used to block the constant sending of emails when the level is at a minimum.'), ensure_ascii=False)}><input name="eml_tank2_high_lvl" type="number" min="0" max="100" step="1" value="$plugin_options['eml_tank2_high_lvl']"></td>
                    <td colspan="2"><input name="eml_subject_2" type="text" value="$plugin_options['eml_subject_2']"></td>
                </tr>

                <!-- Tank 3 -->
                <tr>
                    <td>$plugin_options['label3']</td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" name="en_eml_tank3_low" ${'checked' if plugin_options['en_eml_tank3_low'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If the level drops below this value, sending an email is activated.'), ensure_ascii=False)}><input name="eml_tank3_low_lvl" type="number" min="0" max="100" step="1" value="$plugin_options['eml_tank3_low_lvl']"></td>
                    <td title=$:{json.dumps(_('As long as the level does not rise above this level, it will not allow sending an email when the level drops to the minimum. This is used to block the constant sending of emails when the level is at a minimum.'), ensure_ascii=False)}><input name="eml_tank3_high_lvl" type="number" min="0" max="100" step="1" value="$plugin_options['eml_tank3_high_lvl']"></td>
                    <td colspan="2"><input name="eml_subject_3" type="text" value="$plugin_options['eml_subject_3']"></td>
                </tr>

                <!-- Tank 4 -->
                <tr>
                    <td>$plugin_options['label4']</td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" name="en_eml_tank4_low" ${'checked' if plugin_options['en_eml_tank4_low'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If the level drops below this value, sending an email is activated.'), ensure_ascii=False)}><input name="eml_tank4_low_lvl" type="number" min="0" max="100" step="1" value="$plugin_options['eml_tank4_low_lvl']"></td>
                    <td title=$:{json.dumps(_('As long as the level does not rise above this level, it will not allow sending an email when the level drops to the minimum. This is used to block the constant sending of emails when the level is at a minimum.'), ensure_ascii=False)}><input name="eml_tank4_high_lvl" type="number" min="0" max="100" step="1" value="$plugin_options['eml_tank4_high_lvl']"></td>
                    <td colspan="2"><input name="eml_subject_4" type="text" value="$plugin_options['eml_subject_4']"></td>
                </tr>

                <!-- events Regulate maximum -->
                <tr>
                    <td colspan="6"><hr></td>
                    <td><b><small>$_('Regulate maximum')</small></b></td>
                </tr>

                <tr>
                    <th>$_('Tank')</th>
                    <th>$_('Regulate')</th>
                    <th>$_('Max level (cm)')</th>
                    <th>$_('Max run time (mm:ss)')</th>
                    <th>$_('Min level (cm)')</th>
                    <th>$_('Select Output')</th>
                </tr>
                
                <!-- Tank 1 events - Regulate maximum water level -->
                <tr>
                    <td>$plugin_options['label1']</td>
                    <td title=$:{json.dumps(_('If checked, regulation is enabled'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="en_reg_tank1" ${'checked' if plugin_options['en_reg_tank1'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If the measured water level exceeds this set value, the output is activated'), ensure_ascii=False)}><input name='reg_max_tank1' type='number' min="1" value='$plugin_options["reg_max_tank1"]'></td>
                    <td title=$:{json.dumps(_('Maximum duration when activating the output (in minutes and seconds). After this time, the output will turn off regardless of other events (conditions)'), ensure_ascii=False)}><input id="reg_mm_tank1" name="reg_mm_tank1" type="number" size="3" maxlength="3" value='$plugin_options["reg_mm_tank1"]' min="0" max="999">:<input id="reg_ss_tank1" name="reg_ss_tank1" type="number" size="2" maxlength="2" value='$plugin_options["reg_ss_tank1"]' min="0" max="59"></td>
                    <td title=$:{json.dumps(_('If the measured water level falls below this set value, the output is deactivated'), ensure_ascii=False)}><input name='reg_min_tank1' type='number' min="1" value='$plugin_options["reg_min_tank1"]'></td>
                    <td title=$:{json.dumps(_('Select Output for controled zones'), ensure_ascii=False)}>
                    <select name="reg_out_tank1">
                    $for station in stations.get():
                        <option value="${str(station.index)}" ${"selected" if plugin_options["reg_out_tank1"]==station.index else ""}>${station.name} ($_('Output') ${str(station.index+1)})</option>
                    </select>
                    </td>
                </tr>

                <!-- Tank 2 events - Regulate maximum water level -->
                <tr>
                    <td>$plugin_options['label2']</td>
                    <td title=$:{json.dumps(_('If checked, regulation is enabled'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="en_reg_tank2" ${'checked' if plugin_options['en_reg_tank2'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If the measured water level exceeds this set value, the output is activated'), ensure_ascii=False)}><input name='reg_max_tank2' type='number' min="1" value='$plugin_options["reg_max_tank2"]'></td>
                    <td title=$:{json.dumps(_('Maximum duration when activating the output (in minutes and seconds). After this time, the output will turn off regardless of other events (conditions)'), ensure_ascii=False)}><input id="reg_mm_tank2" name="reg_mm_tank2" type="number" size="3" maxlength="3" value='$plugin_options["reg_mm_tank2"]' min="0" max="999">:<input id="reg_ss_tank2" name="reg_ss_tank2" type="number" size="2" maxlength="2" value='$plugin_options["reg_ss_tank2"]' min="0" max="59"></td>
                    <td title=$:{json.dumps(_('If the measured water level falls below this set value, the output is deactivated'), ensure_ascii=False)}><input name='reg_min_tank2' type='number' min="1" value='$plugin_options["reg_min_tank2"]'></td>
                    <td title=$:{json.dumps(_('Select Output for controled zones'), ensure_ascii=False)}>
                    <select name="reg_out_tank2">
                    $for station in stations.get():
                        <option value="${str(station.index)}" ${"selected" if plugin_options["reg_out_tank2"]==station.index else ""}>${station.name} ($_('Output') ${str(station.index+1)})</option>
                    </select>
                    </td>
                </tr>

                <!-- Tank 3 events - Regulate maximum water level -->
                <tr>
                    <td>$plugin_options['label3']</td>
                    <td title=$:{json.dumps(_('If checked, regulation is enabled'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="en_reg_tank3" ${'checked' if plugin_options['en_reg_tank3'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If the measured water level exceeds this set value, the output is activated'), ensure_ascii=False)}><input name='reg_max_tank3' type='number' min="1" value='$plugin_options["reg_max_tank3"]'></td>
                    <td title=$:{json.dumps(_('Maximum duration when activating the output (in minutes and seconds). After this time, the output will turn off regardless of other events (conditions)'), ensure_ascii=False)}><input id="reg_mm_tank3" name="reg_mm_tank3" type="number" size="3" maxlength="3" value='$plugin_options["reg_mm_tank3"]' min="0" max="999">:<input id="reg_ss_tank3" name="reg_ss_tank3" type="number" size="2" maxlength="2" value='$plugin_options["reg_ss_tank3"]' min="0" max="59"></td>
                    <td title=$:{json.dumps(_('If the measured water level falls below this set value, the output is deactivated'), ensure_ascii=False)}><input name='reg_min_tank3' type='number' min="1" value='$plugin_options["reg_min_tank3"]'></td>
                    <td title=$:{json.dumps(_('Select Output for controled zones'), ensure_ascii=False)}>
                    <select name="reg_out_tank3">
                    $for station in stations.get():
                        <option value="${str(station.index)}" ${"selected" if plugin_options["reg_out_tank3"]==station.index else ""}>${station.name} ($_('Output') ${str(station.index+1)})</option>
                    </select>
                    </td>
                </tr>

                <!-- Tank 4 events - Regulate maximum water level -->
                <tr>
                    <td>$plugin_options['label4']</td>
                    <td title=$:{json.dumps(_('If checked, regulation is enabled'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="en_reg_tank4" ${'checked' if plugin_options['en_reg_tank4'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If the measured water level exceeds this set value, the output is activated'), ensure_ascii=False)}><input name='reg_max_tank4' type='number' min="1" value='$plugin_options["reg_max_tank4"]'></td>
                    <td title=$:{json.dumps(_('Maximum duration when activating the output (in minutes and seconds). After this time, the output will turn off regardless of other events (conditions)'), ensure_ascii=False)}><input id="reg_mm_tank4" name="reg_mm_tank4" type="number" size="3" maxlength="3" value='$plugin_options["reg_mm_tank4"]' min="0" max="999">:<input id="reg_ss_tank4" name="reg_ss_tank4" type="number" size="2" maxlength="2" value='$plugin_options["reg_ss_tank4"]' min="0" max="59"></td>
                    <td title=$:{json.dumps(_('If the measured water level falls below this set value, the output is deactivated'), ensure_ascii=False)}><input name='reg_min_tank4' type='number' min="1" value='$plugin_options["reg_min_tank4"]'></td>
                    <td title=$:{json.dumps(_('Select Output for controled zones'), ensure_ascii=False)}>
                    <select name="reg_out_tank4">
                    $for station in stations.get():
                        <option value="${str(station.index)}" ${"selected" if plugin_options["reg_out_tank4"]==station.index else ""}>${station.name} ($_('Output') ${str(station.index+1)})</option>
                    </select>
                    </td>
                </tr>

                <!-- events Regulate minimum -->
                <tr>
                    <td colspan="6"><hr></td>
                    <td><b><small>$_('Regulate minimum') NOT READY TO USE!</small></b></td>
                </tr>

                <tr>
                    <th>$_('Tank')</th>
                    <th>$_('Regulate')</th>
                    <th>$_('Max level (cm)')</th>
                    <th>$_('Max run time (mm:ss)')</th>
                    <th>$_('Min level (cm)')</th>
                    <th>$_('Select Output')</th>
                </tr>
                
                <!-- Tank 1 events - Regulate minimum water level -->
                <tr>
                    <td>$plugin_options['label1']</td>
                    <td title=$:{json.dumps(_('If checked, regulation is enabled'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="mini_en_reg_tank1" ${'checked' if plugin_options['mini_en_reg_tank1'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If the measured water level exceeds this set value, the output is deactivated'), ensure_ascii=False)}><input name='mini_reg_max_tank1' type='number' min="1" value='$plugin_options["mini_reg_max_tank1"]'></td>
                    <td title=$:{json.dumps(_('Maximum duration when activating the output (in minutes and seconds). After this time, the output will turn off regardless of other events (conditions)'), ensure_ascii=False)}><input id="mini_reg_mm_tank1" name="mini_reg_mm_tank1" type="number" size="3" maxlength="3" value='$plugin_options["mini_reg_mm_tank1"]' min="0" max="999">:<input id="mini_reg_ss_tank1" name="mini_reg_ss_tank1" type="number" size="2" maxlength="2" value='$plugin_options["mini_reg_ss_tank1"]' min="0" max="59"></td>
                    <td title=$:{json.dumps(_('If the measured water level falls below this set value, the output is activated'), ensure_ascii=False)}><input name='mini_reg_min_tank1' type='number' min="1" value='$plugin_options["mini_reg_min_tank1"]'></td>
                    <td title=$:{json.dumps(_('Select Output for controled zones'), ensure_ascii=False)}>
                    <select name="mini_reg_out_tank1">
                    $for station in stations.get():
                        <option value="${str(station.index)}" ${"selected" if plugin_options["mini_reg_out_tank1"]==station.index else ""}>${station.name} ($_('Output') ${str(station.index+1)})</option>
                    </select>
                    </td>
                </tr>

                <!-- Tank 2 events - Regulate minimum water level -->
                <tr>
                    <td>$plugin_options['label2']</td>
                    <td title=$:{json.dumps(_('If checked, regulation is enabled'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="mini_en_reg_tank2" ${'checked' if plugin_options['mini_en_reg_tank2'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If the measured water level exceeds this set value, the output is deactivated'), ensure_ascii=False)}><input name='mini_reg_max_tank2' type='number' min="1" value='$plugin_options["mini_reg_max_tank2"]'></td>
                    <td title=$:{json.dumps(_('Maximum duration when activating the output (in minutes and seconds). After this time, the output will turn off regardless of other events (conditions)'), ensure_ascii=False)}><input id="mini_reg_mm_tank2" name="mini_reg_mm_tank2" type="number" size="3" maxlength="3" value='$plugin_options["mini_reg_mm_tank2"]' min="0" max="999">:<input id="mini_reg_ss_tank2" name="mini_reg_ss_tank2" type="number" size="2" maxlength="2" value='$plugin_options["mini_reg_ss_tank2"]' min="0" max="59"></td>
                    <td title=$:{json.dumps(_('If the measured water level falls below this set value, the output is activated'), ensure_ascii=False)}><input name='mini_reg_min_tank2' type='number' min="1" value='$plugin_options["mini_reg_min_tank2"]'></td>
                    <td title=$:{json.dumps(_('Select Output for controled zones'), ensure_ascii=False)}>
                    <select name="mini_reg_out_tank2">
                    $for station in stations.get():
                        <option value="${str(station.index)}" ${"selected" if plugin_options["mini_reg_out_tank2"]==station.index else ""}>${station.name} ($_('Output') ${str(station.index+1)})</option>
                    </select>
                    </td>
                </tr>

                <!-- Tank 3 events - Regulate minimum water level -->
                <tr>
                    <td>$plugin_options['label3']</td>
                    <td title=$:{json.dumps(_('If checked, regulation is enabled'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="mini_en_reg_tank3" ${'checked' if plugin_options['mini_en_reg_tank3'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If the measured water level exceeds this set value, the output is deactivated'), ensure_ascii=False)}><input name='mini_reg_max_tank3' type='number' min="1" value='$plugin_options["mini_reg_max_tank3"]'></td>
                    <td title=$:{json.dumps(_('Maximum duration when activating the output (in minutes and seconds). After this time, the output will turn off regardless of other events (conditions)'), ensure_ascii=False)}><input id="mini_reg_mm_tank3" name="mini_reg_mm_tank3" type="number" size="3" maxlength="3" value='$plugin_options["mini_reg_mm_tank3"]' min="0" max="999">:<input id="mini_reg_ss_tank3" name="mini_reg_ss_tank3" type="number" size="2" maxlength="2" value='$plugin_options["mini_reg_ss_tank3"]' min="0" max="59"></td>
                    <td title=$:{json.dumps(_('If the measured water level falls below this set value, the output is activated'), ensure_ascii=False)}><input name='mini_reg_min_tank3' type='number' min="1" value='$plugin_options["mini_reg_min_tank3"]'></td>
                    <td title=$:{json.dumps(_('Select Output for controled zones'), ensure_ascii=False)}>
                    <select name="mini_reg_out_tank3">
                    $for station in stations.get():
                        <option value="${str(station.index)}" ${"selected" if plugin_options["mini_reg_out_tank3"]==station.index else ""}>${station.name} ($_('Output') ${str(station.index+1)})</option>
                    </select>
                    </td>
                </tr>

                <!-- Tank 4 events - Regulate minimum water level -->
                <tr>
                    <td>$plugin_options['label4']</td>
                    <td title=$:{json.dumps(_('If checked, regulation is enabled'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="mini_en_reg_tank4" ${'checked' if plugin_options['mini_en_reg_tank4'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If the measured water level exceeds this set value, the output is deactivated'), ensure_ascii=False)}><input name='mini_reg_max_tank4' type='number' min="1" value='$plugin_options["mini_reg_max_tank4"]'></td>
                    <td title=$:{json.dumps(_('Maximum duration when activating the output (in minutes and seconds). After this time, the output will turn off regardless of other events (conditions)'), ensure_ascii=False)}><input id="mini_reg_mm_tank4" name="mini_reg_mm_tank4" type="number" size="3" maxlength="3" value='$plugin_options["mini_reg_mm_tank4"]' min="0" max="999">:<input id="mini_reg_ss_tank4" name="mini_reg_ss_tank4" type="number" size="2" maxlength="2" value='$plugin_options["mini_reg_ss_tank4"]' min="0" max="59"></td>
                    <td title=$:{json.dumps(_('If the measured water level falls below this set value, the output is activated'), ensure_ascii=False)}><input name='mini_reg_min_tank4' type='number' min="1" value='$plugin_options["mini_reg_min_tank4"]'></td>
                    <td title=$:{json.dumps(_('Select Output for controled zones'), ensure_ascii=False)}>
                    <select name="mini_reg_out_tank4">
                    $for station in stations.get():
                        <option value="${str(station.index)}" ${"selected" if plugin_options["mini_reg_out_tank4"]==station.index else ""}>${station.name} ($_('Output') ${str(station.index+1)})</option>
                    </select>
                    </td>
                </tr>

                <!-- events Stoping stations if is minimum water -->
                <tr>
                    <td colspan="6"><hr></td>
                    <td><b><small>$_('Stoping stations')</small></b></td>
                </tr>

                <tr>
                    <th>$_('Tank')</th>
                    <th>$_('Stop')</th>
                    <th>$_('Delay (hours)')</th>
                    <th>$_('Blocking (cm)')</th>
                    <th>$_('Unblocking (cm)')</th>
                    <th>$_('Removing Delay')</th>
                    <th>$_('Stop station')</th>
                </tr>
                
                <!-- Tank 1 events - Stoping stations -->
                <tr>
                    <td>$plugin_options['label1']</td>
                    <td title=$:{json.dumps(_('Stoping these stations if is minimum water level in the tank'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="en_stop_tank1" ${'checked' if plugin_options['en_stop_tank1'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If there is no water in the tank and the stations stop, then we set the rain delay for this time for blocking. if the level in the tank rises above the minimum + xx cm, the delay is deactivated'), ensure_ascii=False)}>
                    <input name='delay_duration_tank1' type='number' min="0" max="96" value='$plugin_options["delay_duration_tank1"]'>
                    </td>
                    <td title=$:{json.dumps(_('Enter the level for Blocking delay duration and stop stations'), ensure_ascii=False)}><input name='water_block_tank1' type='number' min="1" value='$plugin_options["water_block_tank1"]'></td>
                    <td title=$:{json.dumps(_('Enter the level for unblocking delay duration and stop stations'), ensure_ascii=False)}><input name='water_unblock_tank1' type='number' min="1" value='$plugin_options["water_unblock_tank1"]'></td>
                    <td><a href="?del_rain_1"  class="button cancel danger">$_('Remove')</a></td>
                    <td title=$:{json.dumps(_('Use this station for stoping scheduler if station is activated in scheduler'), ensure_ascii=False)}>
                    <select name="used_stations_tank1">
                    $for station in [station for station in stations if station.enabled]:
                        <option value="${str(station.index)}" ${"selected" if station.index in plugin_options['used_stations_tank1'] else ""}>${station.name} ($_('Output') ${str(station.index+1)})</option>
                    </select>
                    </td>
                </tr>

                <!-- Tank 2 events - Stoping stations -->
                <tr>
                    <td>$plugin_options['label2']</td>
                    <td title=$:{json.dumps(_('Stoping these stations if is minimum water level in the tank'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="en_stop_tank2" ${'checked' if plugin_options['en_stop_tank2'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If there is no water in the tank and the stations stop, then we set the rain delay for this time for blocking. if the level in the tank rises above the minimum + xx cm, the delay is deactivated'), ensure_ascii=False)}>
                    <input name='delay_duration_tank2' type='number' min="0" max="96" value='$plugin_options["delay_duration_tank2"]'>
                    </td>
                    <td title=$:{json.dumps(_('Enter the level for Blocking delay duration and stop stations'), ensure_ascii=False)}><input name='water_block_tank2' type='number' min="1" value='$plugin_options["water_block_tank2"]'></td>                    
                    <td title=$:{json.dumps(_('Enter the level for unblocking delay duration and stop stations'), ensure_ascii=False)}><input name='water_unblock_tank2' type='number' min="1" value='$plugin_options["water_unblock_tank2"]'></td>
                    <td><a href="?del_rain_2"  class="button cancel danger">$_('Remove')</a></td>
                    <td title=$:{json.dumps(_('Use this station for stoping scheduler if station is activated in scheduler'), ensure_ascii=False)}>
                    <select name="used_stations_tank2">
                    $for station in [station for station in stations if station.enabled]:
                        <option value="${str(station.index)}" ${"selected" if station.index in plugin_options['used_stations_tank2'] else ""}>${station.name} ($_('Output') ${str(station.index+1)})</option>
                    </select>
                    </td>
                </tr>

                <!-- Tank 3 events - Stoping stations -->
                <tr>
                    <td>$plugin_options['label3']</td>
                    <td title=$:{json.dumps(_('Stoping these stations if is minimum water level in the tank'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="en_stop_tank3" ${'checked' if plugin_options['en_stop_tank3'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If there is no water in the tank and the stations stop, then we set the rain delay for this time for blocking. if the level in the tank rises above the minimum + xx cm, the delay is deactivated'), ensure_ascii=False)}>
                    <input name='delay_duration_tank3' type='number' min="0" max="96" value='$plugin_options["delay_duration_tank3"]'>
                    </td>
                    <td title=$:{json.dumps(_('Enter the level for Blocking delay duration and stop stations'), ensure_ascii=False)}><input name='water_block_tank3' type='number' min="1" value='$plugin_options["water_block_tank3"]'></td>
                    <td title=$:{json.dumps(_('Enter the level for unblocking delay duration and stop stations'), ensure_ascii=False)}><input name='water_unblock_tank3' type='number' min="1" value='$plugin_options["water_unblock_tank3"]'></td>
                    <td><a href="?del_rain_3"  class="button cancel danger">$_('Remove')</a></td>
                    <td title=$:{json.dumps(_('Use this station for stoping scheduler if station is activated in scheduler'), ensure_ascii=False)}>
                    <select name="used_stations_tank3">
                    $for station in [station for station in stations if station.enabled]:
                        <option value="${str(station.index)}" ${"selected" if station.index in plugin_options['used_stations_tank3'] else ""}>${station.name} ($_('Output') ${str(station.index+1)})</option>
                    </select>
                    </td>
                </tr>

                <!-- Tank 4 events - Stoping stations -->
                <tr>
                    <td>$plugin_options['label4']</td>
                    <td title=$:{json.dumps(_('Stoping these stations if is minimum water level in the tank'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="en_stop_tank4" ${'checked' if plugin_options['en_stop_tank4'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('If there is no water in the tank and the stations stop, then we set the rain delay for this time for blocking. if the level in the tank rises above the minimum + xx cm, the delay is deactivated'), ensure_ascii=False)}>
                    <input name='delay_duration_tank4' type='number' min="0" max="96" value='$plugin_options["delay_duration_tank4"]'>
                    </td>
                    <td title=$:{json.dumps(_('Enter the level for Blocking delay duration and stop stations'), ensure_ascii=False)}><input name='water_block_tank4' type='number' min="1" value='$plugin_options["water_block_tank4"]'></td>
                    <td title=$:{json.dumps(_('Enter the level for unblocking delay duration and stop stations'), ensure_ascii=False)}><input name='water_unblock_tank4' type='number' min="1" value='$plugin_options["water_unblock_tank4"]'></td>
                    <td><a href="?del_rain_4"  class="button cancel danger">$_('Remove')</a></td>
                    <td title=$:{json.dumps(_('Use this station for stoping scheduler if station is activated in scheduler'), ensure_ascii=False)}>
                    <select name="used_stations_tank4">
                    $for station in [station for station in stations if station.enabled]:
                        <option value="${str(station.index)}" ${"selected" if station.index in plugin_options['used_stations_tank4'] else ""}>${station.name} ($_('Output') ${str(station.index+1)})</option>
                    </select>
                    </td>
                </tr>

                <!-- info -->
                <tr>
                    <td colspan="6"><hr></td>
                    <td><b><small>$_('Info')</small></b></td>
                </tr>

                <tr>
                    <td style='text-transform: none;'>$_('Status')</td>
                    <td colspan="5"><textarea style="font-family: monospace;" rows="10" cols="50" readonly>$'\n'.join(events)</textarea></td>
                </tr>
            </table>
        </form>
</div>

<div id="controls">
    <button id="cSubmit2" class="submit"><b>$_('Submit')</b></button>
    <a href="/plugins/current_loop_tanks_monitor/settings" class="button danger">$_('Cancel')</a>
</div>