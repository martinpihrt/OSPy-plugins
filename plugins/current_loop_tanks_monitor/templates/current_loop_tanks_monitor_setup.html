$def with(plugin_options, events)

$var title: $_('Current Loop Tanks - Setup')
$var page: plugins

<style>
.switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.switch input {
    display: none;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ff4d4d; /* Default red for 'off' */
    transition: 0.4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    border-radius: 50%;
    left: 4px;
    bottom: 3px;
    background-color: white;
    transition: 0.4s;
}

/* Green color when switch is 'on' */
input:checked + .slider {
    background-color: #4caf50;
}

input:checked + .slider:before {
    transform: translateX(26px);
}
</style>

<script>
jQuery(document).ready(function(){
    jQuery("#cSubmit").click(function() {
            jQuery("#pluginForm").submit();
        });
});
</script>

<div id="plugin">
    <div class="title">$_('Current Loop Tanks - Setup')</div>
        <form id="pluginForm" action="$plugins.plugin_url('current_loop_tanks_monitor.setup_page')" method="post">
            <table class="optionList">
                <tr>
                    <td colspan="5"></td>
                    <td><b><small>$_('Tanks')</small></b></td>
                </tr>

                <tr>
                    <th>$_('Tank Name')</th>
                    <th>$_('Enabled')</th>
                    <th>$_('Max Height (cm)')</th>
                    <th>$_('Max Volume (l)')</th>
                    <th>$_('Min Voltage')</th>
                    <th>$_('Max Voltage')</th>
                </tr>
                
                <!-- Tank 1 -->
                <tr>
                    <td><input name="label1" type="text" value="$plugin_options['label1']"></td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" name="en_tank1" ${'checked' if plugin_options['en_tank1'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('Here, enter the distance from the sensor to the maximum level in centimeters.'), ensure_ascii=False)}><input name="maxHeightCm1" type="number" value="$plugin_options['maxHeightCm1']"></td>
                    <td title=$:{json.dumps(_('Here, enter the volume of the tank at 100% volume (regardless of the shape of the tank).'), ensure_ascii=False)}><input name="maxVolume1" type="number" value="$plugin_options['maxVolume1']"></td>
                    <td title=$:{json.dumps(_('Minimum voltage from the probe on the AD converter (for 4mA ie empty tank).'), ensure_ascii=False)}><input name="minVolt1" type="number" step="0.001" value="$plugin_options['minVolt1']"></td>
                    <td title=$:{json.dumps(_('Maximum voltage from the probe on the AD converter (for 20mA ie full tank).'), ensure_ascii=False)}><input name="maxVolt1" type="number" step="0.001" value="$plugin_options['maxVolt1']"></td>
                </tr>

                <!-- Tank 2 -->
                <tr>
                    <td><input name="label2" type="text" value="$plugin_options['label2']"></td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" name="en_tank2" ${'checked' if plugin_options['en_tank2'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('Here, enter the distance from the sensor to the maximum level in centimeters.'), ensure_ascii=False)}><input name="maxHeightCm2" type="number" value="$plugin_options['maxHeightCm2']"></td>
                    <td title=$:{json.dumps(_('Here, enter the volume of the tank at 100% volume (regardless of the shape of the tank).'), ensure_ascii=False)}><input name="maxVolume2" type="number" value="$plugin_options['maxVolume2']"></td>
                    <td title=$:{json.dumps(_('Minimum voltage from the probe on the AD converter (for 4mA ie empty tank).'), ensure_ascii=False)}><input name="minVolt2" type="number" step="0.001" value="$plugin_options['minVolt2']"></td>
                    <td title=$:{json.dumps(_('Maximum voltage from the probe on the AD converter (for 20mA ie full tank).'), ensure_ascii=False)}><input name="maxVolt2" type="number" step="0.001" value="$plugin_options['maxVolt2']"></td>
                </tr>

                <!-- Tank 3 -->
                <tr>
                    <td><input name="label3" type="text" value="$plugin_options['label3']"></td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" name="en_tank3" ${'checked' if plugin_options['en_tank3'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('Here, enter the distance from the sensor to the maximum level in centimeters.'), ensure_ascii=False)}><input name="maxHeightCm3" type="number" value="$plugin_options['maxHeightCm3']"></td>
                    <td title=$:{json.dumps(_('Here, enter the volume of the tank at 100% volume (regardless of the shape of the tank).'), ensure_ascii=False)}><input name="maxVolume3" type="number" value="$plugin_options['maxVolume3']"></td>
                    <td title=$:{json.dumps(_('Minimum voltage from the probe on the AD converter (for 4mA ie empty tank).'), ensure_ascii=False)}><input name="minVolt3" type="number" step="0.001" value="$plugin_options['minVolt3']"></td>
                    <td title=$:{json.dumps(_('Maximum voltage from the probe on the AD converter (for 20mA ie full tank).'), ensure_ascii=False)}><input name="maxVolt3" type="number" step="0.001" value="$plugin_options['maxVolt3']"></td>
                </tr>

                <!-- Tank 4 -->
                <tr>
                    <td><input name="label4" type="text" value="$plugin_options['label4']"></td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" name="en_tank4" ${'checked' if plugin_options['en_tank4'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td title=$:{json.dumps(_('Here, enter the distance from the sensor to the maximum level in centimeters.'), ensure_ascii=False)}><input name="maxHeightCm4" type="number" value="$plugin_options['maxHeightCm4']"></td>
                    <td title=$:{json.dumps(_('Here, enter the volume of the tank at 100% volume (regardless of the shape of the tank).'), ensure_ascii=False)}><input name="maxVolume4" type="number" value="$plugin_options['maxVolume4']"></td>
                    <td title=$:{json.dumps(_('Minimum voltage from the probe on the AD converter (for 4mA ie empty tank).'), ensure_ascii=False)}><input name="minVolt4" type="number" step="0.001" value="$plugin_options['minVolt4']"></td>
                    <td title=$:{json.dumps(_('Maximum voltage from the probe on the AD converter (for 20mA ie full tank).'), ensure_ascii=False)}><input name="maxVolt4" type="number" step="0.001" value="$plugin_options['maxVolt4']"></td>
                </tr>

                <!-- logging and graphing -->
                <tr>
                    <td colspan="5"><hr></td>
                    <td><b><small>$_('Logs and graphs')</small></b></td>
                </tr>      

                <tr>
                    <td>$_('Show data in graph and log from')</td>
                    <td colspan="5" title=$:{json.dumps(_('Choose from where the displayed data in the log and graph will be loaded.'), ensure_ascii=False)}>
                        <select name="type_log">
                            <option value="0" ${'selected' if plugin_options['type_log'] == 0 else ''}>$_('Local File')</option>
                            <option value="1" ${'selected' if plugin_options['type_log'] == 1 else ''}>$_('Database File')</option>
                        </select>
                    </td>
                </tr>

                <tr>
                    <td>$_('Enable SQL Logging')</td>
                    <td colspan="3" title=$:{json.dumps(_('The measured data will be stored in the database. This option requires the database connector extension to be installed and configured.'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="en_sql_log" ${'checked' if plugin_options['en_sql_log'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td colspan="2" title=$:{json.dumps(_('The button will delete the currentmonitor table from the database, thus deleting all saved data from this extension! This promotion is non-refundable!'), ensure_ascii=False)}>
                        <a href="?delSQL" class="button cancel danger">$_('Delete SQL table')</a>
                    </td>
                </tr>

                <tr>
                    <td>$_('Enable local logging')</td>
                    <td colspan="5" title=$:{json.dumps(_('The measured data will be saved locally in a json file. This option rapidly reduces the lifespan of the SD/USB card of the Raspberry Pi system!'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="en_log" ${'checked' if plugin_options['en_log'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                </tr>

                <tr>
                    <td>$_('Maximum number of log records'):</td>
                    <td title=$:{json.dumps(_('0 = unlimited. The maximum number of records sets the number of saved records, i.e. after exceeding the set limit, older data is overwritten.'), ensure_ascii=False)}>
                        <input name='log_records' type='number' min='0' value='$plugin_options["log_records"]'>
                    </td>
                </tr>

                <tr>
                    <td>$_('Interval for logging'):</td>
                    <td title=$:{json.dumps(_('In minutes (Minimum is 1). The logging interval is common for both local storage and sql storage of measured data.'), ensure_ascii=False)}>
                        <input name='log_interval' type='number' min='1' step="1" value='$plugin_options["log_interval"]'> 
                    </td>
                </tr>                

                <tr>
                    <td>$_('Show data in graph from')</td>
                    <td colspan="5" title=$:{json.dumps(_('Datetime FROM for Filtering.'), ensure_ascii=False)}><input name="dt_from" type="datetime-local" value="$plugin_options['dt_from']"></td>
                </tr>

                <tr>
                    <td>$_('Show data in graph to')</td>
                    <td colspan="5" title=$:{json.dumps(_('Datetime TO for Filtering.'), ensure_ascii=False)}><input name="dt_to" type="datetime-local" value="$plugin_options['dt_to']"></td>
                </tr>

                <!-- Additional Settings -->
                <tr>
                    <td colspan="5"><hr></td>
                    <td><b><small>$_('Additional Settings')</small></b></td>
                </tr>

                <tr>
                    <td>$_('I2C Address')</td>
                    <td colspan="5" title=$:{json.dumps(_('Default address is 0x48.'), ensure_ascii=False)}>
                        <select name="i2c">
                            <option value="0" ${'selected' if plugin_options['i2c'] == 0 else ''}>0x48</option>
                            <option value="1" ${'selected' if plugin_options['i2c'] == 1 else ''}>0x49</option>
                            <option value="2" ${'selected' if plugin_options['i2c'] == 2 else ''}>0x4A</option>
                            <option value="3" ${'selected' if plugin_options['i2c'] == 3 else ''}>0x4B</option>
                        </select>
                    </td>
                </tr>

                <tr>
                    <td>$_('Use Footer')</td>
                    <td colspan="5" title=$:{json.dumps(_('Show data from plugin in footer on home page.'), ensure_ascii=False)}>
                        <label class="switch">
                            <input type="checkbox" name="use_footer" ${'checked' if plugin_options['use_footer'] else ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                </tr>
                <tr>
                    <td style='text-transform: none;'>$_('Status'):</td>
                    <td colspan="5">
                        <textarea style="font-family: monospace;" rows="10" cols="50" readonly>$'\n'.join(events)</textarea>
                    </td>
                </tr>

                <!-- events -->
                <tr>
                    <td colspan="5"><hr></td>
                    <td><b><small>$_('Events')</small></b></td>
                </tr>
                                                
            </table>
        </form>
</div>

<div id="controls">
    <button id="cSubmit" class="submit"><b>$_('Submit')</b></button>
    <a href="/plugins/current_loop_tanks_monitor/settings" class="button danger">$_('Cancel')</a>
</div>